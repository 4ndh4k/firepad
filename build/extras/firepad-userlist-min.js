var FirepadUserList=function(){var t=t||{};t.utils={},t.utils.makeEventEmitter=function(t,e){t.prototype.allowedEvents_=e,t.prototype.on=function(t,e,r){this.validateEventType_(t),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[t]=this.eventListeners_[t]||[],this.eventListeners_[t].push({callback:e,context:r})},t.prototype.off=function(t,e){this.validateEventType_(t),this.eventListeners_=this.eventListeners_||{};for(var r=this.eventListeners_[t]||[],n=0;r.length>n;n++)if(r[n].callback===e)return r.splice(n,1),void 0},t.prototype.trigger=function(t){this.eventListeners_=this.eventListeners_||{};for(var e=this.eventListeners_[t]||[],r=0;e.length>r;r++)e[r].callback.apply(e[r].context,Array.prototype.slice.call(arguments,1))},t.prototype.validateEventType_=function(t){if(this.allowedEvents_&&-1===this.allowedEvents_.indexOf(t))throw Error('Unknown event "'+t+'"')}},t.utils.elt=function(e,r,n){var i=document.createElement(e);if("string"==typeof r)t.utils.setTextContent(i,r);else if(r)for(var o=0;r.length>o;++o)i.appendChild(r[o]);for(var s in n||{})i.setAttribute(s,n[s]);return i},t.utils.setTextContent=function(t,e){t.innerHTML="",t.appendChild(document.createTextNode(e))},t.utils.on=function(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent&&t.attachEvent("on"+e,r)},t.utils.off=function(t,e,r){t.removeEventListener?t.removeEventListener(e,r,!1):t.detachEvent&&t.detachEvent("on"+e,r)},t.utils.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},t.utils.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},t.utils.stopEvent=function(e){t.utils.preventDefault(e),t.utils.stopPropagation(e)},t.utils.stopEventAnd=function(e){return function(r){return e(r),t.utils.stopEvent(r),!1}},t.utils.assert=function(t,e){if(!t)throw Error(e||"assertion error")};var t=t||{};return t.UserList=function(){function e(t,r,n){if(!(this instanceof e))return new e(t,r,n);this.ref_=t,this.userId_=n;var i=this;this.displayName_="Guest "+Math.floor(1e3*Math.random()),t.root().child(".info/connected").on("value",function(e){if(e.val()===!0&&i.displayName_){var r=t.child(i.userId_).child("name");r.onDisconnect().remove(),r.set(i.displayName_)}}),r.appendChild(this.makeUserList_())}var r=t.utils;return e.fromDiv=e,e.prototype.makeUserList_=function(){return r.elt("div",[this.makeHeading_(),r.elt("div",[this.makeUserEntryForSelf_(),this.makeUserEntriesForOthers_()],{"class":"firepad-userlist-users"})],{"class":"firepad-userlist"})},e.prototype.makeHeading_=function(){var t=r.elt("span","0");return this.ref_.on("value",function(e){r.setTextContent(t,""+e.numChildren())}),r.elt("div",[r.elt("span","ONLINE ("),t,r.elt("span",")")],{"class":"firepad-userlist-heading"})},e.prototype.makeUserEntryForSelf_=function(){var t=this.ref_.child(this.userId_),e=r.elt("div",null,{"class":"firepad-userlist-color-indicator"});t.child("color").on("value",function(t){e.style.backgroundColor=t.val()});var n=r.elt("input",null,{type:"text","class":"firepad-userlist-name"});return n.value=this.displayName_,r.on(n,"change",function(e){var i=n.value||"Guest "+Math.floor(1e3*Math.random());t.child("name").onDisconnect().remove(),t.child("name").set(i),r.stopEvent(e)}),r.elt("div",[e,n],{"class":"firepad-userlist-user"})},e.prototype.makeUserEntriesForOthers_=function(){function t(t,o){var s=t.name(),a=i[s];a&&(n.removeChild(a),delete i[s]);var h=r.elt("div",null,{"class":"firepad-userlist-color-indicator"});h.style.backgroundColor=t.child("color").val();var u=r.elt("div",t.child("name").val()),c=r.elt("div",[h,u],{"class":"firepad-userlist-user"});i[s]=c,s===e.userId_&&(c.style.display="none");var p=o?i[o].nextSibling:n.firstChild;n.insertBefore(c,p)}var e=this,n=r.elt("div"),i={};return this.ref_.on("child_added",t),this.ref_.on("child_changed",t),this.ref_.on("child_moved",t),this.ref_.on("child_removed",function(t){var e=t.name(),r=i[e];r&&(n.removeChild(r),delete i[e])}),n},e}(),t.UserList}();